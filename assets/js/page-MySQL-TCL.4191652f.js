(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{777:function(s,a,n){"use strict";n.r(a);var t=n(1),e=Object(t.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("blockquote",[n("p",[n("img",{attrs:{src:"https://img.shields.io/badge/TCL-Transaction_Control_Language-blue.svg",alt:""}})])]),s._v(" "),n("h2",{staticStyle:{color:"#ab4642"},attrs:{align:"center"}},[s._v("TCL语言")]),s._v(" "),n("h2",{attrs:{id:"一、什么是事务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一、什么是事务"}},[s._v("#")]),s._v(" 一、什么是事务")]),s._v(" "),n("p",[s._v("一个或一组sql语句组成一个执行单元，这个执行单元要么全部执行，要么全部不执行。")]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[s._v("案例：转账\n\n张三丰  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n郭襄\t"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v(" 表 "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" 张三丰的余额"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'张三丰'")]),s._v("\n意外\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v(" 表 "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" 郭襄的余额"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1500")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'郭襄'")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h2",{attrs:{id:"二、事务的特性-acid"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二、事务的特性-acid"}},[s._v("#")]),s._v(" 二、事务的特性(ACID)")]),s._v(" "),n("ul",[n("li",[s._v("原子性：一个事务不可再分割，要么都执行要么都不执行")]),s._v(" "),n("li",[s._v("一致性：一个事务执行会使数据从一个一致状态切换到另外一个一致状态")]),s._v(" "),n("li",[s._v("隔离性：一个事务的执行不受其他事务的干扰")]),s._v(" "),n("li",[s._v("持久性：一个事务一旦提交，则会永久的改变数据库的数据.")])]),s._v(" "),n("h2",{attrs:{id:"三、事务的使用步骤-★"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三、事务的使用步骤-★"}},[s._v("#")]),s._v(" 三、事务的使用步骤 ★")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("了解")]),s._v(" "),n("p",[s._v("（1）隐式（自动）事务：没有明显的开启和结束，本身就是一条事务可以自动提交，比如insert、update、delete")]),s._v(" "),n("p",[s._v("（2）显式事务：事务具有明显的开启和结束的标记；前提：必须先设置自动提交功能为禁用")]),s._v(" "),n("p",[s._v("​          具体步骤")]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[s._v("①开启事务\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" autocommit"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("start")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("transaction")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#可以省略")]),s._v("\n\n②编写一组逻辑"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sql")]),s._v("语句\n注意："),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sql")]),s._v("语句支持的是"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v("、"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v("、"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("delete")]),s._v("\n\n设置回滚点：\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("savepoint")]),s._v(" 回滚点名"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n③结束事务\n提交："),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("commit")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n回滚："),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rollback")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n回滚到指定的地方："),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rollback")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" 回滚点名"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("案例")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("SHOW VARIABLES LIKE 'autocommit';\nSHOW ENGINES;\n\n#1.演示事务的使用步骤\nDROP TABLE IF EXISTS account;\nCREATE TABLE account(\n\tid INT PRIMARY KEY AUTO_INCREMENT,\n\tusername VARCHAR(20),\n\tbalance DOUBLE\n);\nINSERT INTO account(username,balance)\nVALUES('张无忌',1000),('赵敏',1000);\n\n#开启事务\nSET autocommit=0;\nSTART TRANSACTION;\n#编写一组事务的语句\nUPDATE account SET balance = 1000 WHERE username='张无忌';\nUPDATE account SET balance = 1000 WHERE username='赵敏';\n\n#结束事务\nROLLBACK;\n#commit;\n\nSELECT * FROM account;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br")])])])]),s._v(" "),n("h2",{attrs:{id:"四、并发事务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#四、并发事务"}},[s._v("#")]),s._v(" 四、并发事务")]),s._v(" "),n("p",[s._v("1、"),n("strong",[s._v("事务的并发问题是如何发生的？")])]),s._v(" "),n("ul",[n("li",[s._v("多个事务同时操作 同一个数据库的相同数据时")])]),s._v(" "),n("p",[s._v("2、"),n("strong",[s._v("并发问题都有哪些？")])]),s._v(" "),n("ul",[n("li",[n("p",[s._v("对于同时运行的多个事务, 当这些事务访问数据库中相同的数据时, 如果没有采取必要的隔离机制, 就会导致各种并发问题：")])]),s._v(" "),n("li",[n("p",[s._v("脏读：一个事务读取了其他事务还没有提交的数据，读到的是其他事务“更新”的数据；")])]),s._v(" "),n("li",[n("p",[s._v("不可重复读：一个事务多次读取，结果不一样；")])]),s._v(" "),n("li",[n("p",[s._v("幻读：一个事务读取了其他事务还没有提交的数据，只是读到的是 其他事务“插入”的数据。")])]),s._v(" "),n("li",[n("p",[s._v("数据库事务的隔离性: 数据库系统必须具有隔离并发运行各个事务的能力, 使它们不会相互影响, 避免各种并发问题.")])]),s._v(" "),n("li",[n("p",[s._v("一个事务与其他事务隔离的程度称为隔离级别. 数据库规定了多种事务隔离级别, 不同隔离级别对应不同的干扰程度, 隔离级别越高, 数据一致性就越好, 但并发性越弱")])]),s._v(" "),n("li",[n("p",[s._v("3、如何解决并发问题？")]),s._v(" "),n("ul",[n("li",[s._v("通过设置隔离级别来解决并发问题")])])]),s._v(" "),n("li",[n("p",[s._v("4、隔离级别")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("\t\t\t\t\t\t\t脏读\t\t\t不可重复读\t\t  幻读\nread uncommitted:读未提交     ×                ×              ×        \nread committed：读已提交      √                ×              ×\nrepeatable read：可重复读     √                √              ×\nserializable：串行化          √                √              √\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("Oracle 支持的2 种事务隔离级别：READ COMMITED, SERIALIZABLE。Oracle 默认的事务隔离级别为: READ COMMITED")])]),s._v(" "),n("li",[n("p",[s._v("Mysql 支持4 种事务隔离级别. Mysql 默认的事务隔离级别为: REPEATABLE READ")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("查看隔离级别\nselect @@tx_isolation;\n设置隔离级别\nset session|global transaction isolation level 隔离级别;\n\n#2.演示事务对于delete和truncate的处理的区别\nSET autocommit=0;\nSTART TRANSACTION;\n\nDELETE FROM account;\nROLLBACK;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])])])]),s._v(" "),n("h2",{attrs:{id:"五、回滚点的演示"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#五、回滚点的演示"}},[s._v("#")]),s._v(" 五、回滚点的演示")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("savepoint 节点名;设置保存点")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("#3.演示savepoint 的使用\nSET autocommit=0;\n\nSTART TRANSACTION;\nDELETE FROM account WHERE id=25;\nSAVEPOINT a;#设置保存点\nDELETE FROM account WHERE id=28;\nROLLBACK TO a;#回滚到保存点\n\nSELECT * FROM account;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])])])])])}),[],!1,null,null,null);a.default=e.exports}}]);