(window.webpackJsonp=window.webpackJsonp||[]).push([[229],{771:function(s,t,a){"use strict";a.r(t);var e=a(1),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("本文介绍如何利用 Git 和 GitHub Action，自动部署代码到服务器。")]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),a("p",[s._v("由于 Centos 仍然是用 GitV1，本教程使用 Ubuntu 18.04 进行教学。")])]),s._v(" "),a("h2",{attrs:{id:"添加账户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#添加账户"}},[s._v("#")]),s._v(" 添加账户")]),s._v(" "),a("p",[s._v("为了安全，首先需要使用命令创建 Git 用户，为了安全请务必设置密码。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" adduser "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("之后，查看部署目录所在组，git 用户添加到组中。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("usermod")]),s._v(" -a -G "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("目录所在组"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("然后将部署目录的权限设置为 "),a("code",[s._v("775")]),s._v("，即允许同组访问。这样 git 就有权限访问部署目录。")]),s._v(" "),a("h2",{attrs:{id:"添加权限"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#添加权限"}},[s._v("#")]),s._v(" 添加权限")]),s._v(" "),a("p",[s._v("创建 "),a("code",[s._v("~/.ssh/")]),s._v(" 文件夹，生成 "),a("code",[s._v("authorized_keys")]),s._v(" 文件，并设置其权限为 "),a("code",[s._v("600")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p ~/.ssh/\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" ~/.ssh/authorized_keys\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" ~/.ssh/authorized_keys\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("之后将需要赋予权限的用户公钥依次粘贴至该文件。")]),s._v(" "),a("h2",{attrs:{id:"创建仓库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建仓库"}},[s._v("#")]),s._v(" 创建仓库")]),s._v(" "),a("p",[s._v("回到 "),a("code",[s._v("/home/git/")]),s._v("，创建所需的文件夹:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ~\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("仓库名"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("进入文件夹，使用")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" init --separate-git-dir"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(". "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("部署位置"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("这会将 git 库保持在 "),a("code",[s._v("/home/git/<仓库名>")]),s._v(" 下，同时将工作区设置到部署文件夹中。")]),s._v(" "),a("p",[s._v("接下来执行:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" config receive.denyCurrentBranch ignore\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("这是由于 Git 默认拒绝外部对当前的推送操作，因为这可能会覆盖或变更工作区文件。")]),s._v(" "),a("h2",{attrs:{id:"github-actions-构建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#github-actions-构建"}},[s._v("#")]),s._v(" GitHub Actions 构建")]),s._v(" "),a("p",[s._v("在正常的工作流程中，完成页面的构建，并将其推送到 gh-pages 上。")]),s._v(" "),a("p",[s._v("之后只需要使用 GitHub Action 推送到 "),a("code",[s._v("git@<ip>:<部署目录> gh-pages")]),s._v(" 即可。")])])}),[],!1,null,null,null);t.default=n.exports}}]);